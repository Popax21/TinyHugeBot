using ChessChallenge.API;
using static System.AppDomain;

class MyBot : IChessBot {
    //TinyBot_asmBuf either holds the TinyBot IChessBot instance, or the assembly buffer during decoding
    dynamic TinyBot_asmBuf = new byte[8192];
    int asmBufOff, scaleParity;
    byte scaleAccum;

    public MyBot() {
        //Decode the assembly
        //The assembly is encoded in a semi-RLE-like format
        //There are two types of tokens:
        // - scaling factors 0-15: regular tokens
        //   - the decimal integer number encodes 12 bytes, which are copied to the assembly buffer
        //   - the decimal scaling factor encodes an additional 4 bits - two regular tokens are paired up, and their scaling factors are combined to form an extra byte
        // - scaling factor 16: skip tokens (can skip up to 255 bytes forward to efficiently encode a stretch of zero bytes)
        //   - the lowest byte of the decimal integer number contains the amount of bytes to skip forward by
        //   - the remaining 11 integer number bytes are copied to the assembly buffer
        //   - skip tokens are invisible to the scalar accumulator; they don't contribute their scale value, nor do they affect parity
        // - the sign bit is unused as a minus sign would require an extra token
        foreach(decimal dec in new[] {
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BEGIN ENCODED ASSEMBLY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            73786.976307732568653M,19807040628566.084401472995583M,31105283551.3167525259001891M,705415172608M,137428256861082337018080M,7737125245.5336267181203469M,73786978493861462528M,3868562622.7668133590598660M,41277563240262130762296328704M,7555786.3725983042899970M,1152921504606846992M,0.0000309237645936M,3518163029.7506917289045508M,9444732998724639261184M,0.0000412316868620M,2891977270.1383876501588121M,1099512098304M,944473.2966838802055477M,113640539676789186605613060M,1136405397032481866098.93458M,253782147137085114486609914.88M,19188552296141429730353110528M,128148110699625849560957030M,67701450782042557441.900638M,294014159497557021822487301.12M,28782648991943840730045240576M,124520835189950760495743046M,1051783725586247621517.64045M,210454198520417610646.23298048M,31877461311153407149993917952M,119685463949226554786644067M,107597865954980.428919799919M,464234456726761390344870574.08M,55088624547603614351900051968M,304651944502443839004344500M,27322107222350963871.7636785M,2537821471370871705715087.8464M,25378214713708511448660991488M,99133651225423872846331998M,337294546512565667927425118M,21678542986558909054515404.81M,73968371851815038432705592833M,333669687502439385779208476M,311908819832376628912521.552M,287834187549025.03676482481409M,30330905196791160740551661569M,39169674335220953191297871.0M,423129515647471950801207.559M,89767559134934287804300935.69M,8667252011756163248938895617M,36631142251080480030870768.4M,3179541130211177276786610.14M,451861856695127222499557378.57M,47661976029749627819107885569M,35784676504672353002697549.4M,43521844180785433371063118.5M,70873578424881718928485748481M,3715251012410718361038662144M,30707158547106395425898524.8M,331251798944670299058.733378M,2971193989865023815.5103477761M,27236059818782448609237475329M,46060588402173198717793103.2M,4666509189459230106822249.30M,8976788968041207229749235201M,15785530022130072971064212481M,35059555287566686808375333.9M,36268471883555937475.6905335M,3744912181654487316.1211065857M,32497286099377874136629064449M,50170991529207758909564547.8M,4497260681602269582219021.30M,10214903736976105.217208707841M,12071804350955098680770795521M,36389336795570193283357123.1M,367519850265514650902.790483M,39305937429944701842414968065M,34973142563738307639365412097M,41104010987033624220080565.2M,43159168279547318235267101.0M,93071235768096041391579392.1M,75207143048498302853440466434M,61172445230367390424288504.8M,62139650450226.3042778202573M,46425117412749357.855369459457M,63446844897585559411227753729M,57666693169704552323796223.5M,533145436160089080337007092M,1240187923201686407324222.210M,76754563375166462444546680322M,62260539342951540726045127.0M,621397113245099147739857380M,66851189450713612175836053762M,311935954271494870524888833M,6504114804923361682321577.01M,615352889972862374453772795M,7830233788061797.5107165492994M,930915419872112254042382337M,6407400739354191477214417.89M,633486094743.180717501383184M,73971181718023047.465924691969M,74899589524615324024501931011M,1178719571621624972854166.435M,12524639912843590987.95950975M,4488023775153134172.1955992323M,47046495870499824781794475523M,1138826993363855145452766.211M,1143662991790781847294772220M,76756834868969609194341.903620M,78304274086905236872050752259M,1206525658690638217675539.402M,121982386114948.3964593210283M,696389582610439735989231.94371M,53855151920334643421304324611M,1188393523826691457426719.752M,11424548591817.25530859439161M,623541343897905022.361638659M,8979603556976454402593509636M,123916606551738580476880.5830M,1310493352968694.673176396734M,58188234846717201694958300.419M,72729038696330.450939479585027M,79212445980539.376163421028298M,79195521554016127393670365208M,6592037320046557929242.4664320M,2785341477208215113928019711M,79202775035155282981448515567M,7919189518238537168284300084.3M,73966690673133803243269255424M,7736941074826033283437953023M,12088649460347069796188114M,27804943361.028676979654605M,7149116477046405132057995.4943M,76442816312744.119754815447551M,79208820125426.180245037776906M,265971981366940988266250.39M,5570730175919551.994663004672M,5570692399149377276237310976M,14506574886552648754331644M,79206402163096.072000351174591M,61904557512850445248233036.7M,54159437532815.796341280080896M,79130237807305.553902853619618M,7913023780730555390.2853619618M,15467544538986014403680862.71M,9593057757305.756713765261311M,79002092002411.783115513921420M,79034732317040557664692.535207M,6034875049338952.0714403375871M,52302414136155.269586355179263M,79115730734357.192554235690901M,79162878490846973488.957095838M,526120124830604877781993.84319M,49517171829940.278706072165887M,79107268511876.277691467694023M,7911573086348721593.5934758834M,649914506563593453.66761449471M,61277554981215.929485009851903M,79084298626153.442538940137368M,7913023780730555393.2919832480M,504456740824926884533475530.23M,50445674082492.688453347553023M,78905373749442.403338377363286M,789222998730599138.21440966368M,671570429088274.01906326284030M,47349893657977.852389102645246M,788425104553442.41004912967408M,7877722838728315.6556587138843M,7458369144642509.6641333587710M,77060223214452.840944623314686M,788630597408722.67942068551326M,78879985347986011340.342951562M,49516307618499034662.815332862M,48587748695242.946788099807230M,788497638995856.86337803189974M,7880986903393812.4852508032766M,779885176807182996957.46555134M,77988886028114.260273624170494M,788920749566747.98941438607035M,7894285017314507329037428290.9M,646811533844427589286.67706623M,60348339632949.753911252547326M,787832726105700.30226227003161M,7881833134866064.1533499145964M,742747211745504.38240040435198M,64680733092816.811187909864958M,788860287042581.80497549819552M,78867896200472863143601.372801M,349704129825879.52766969110526M,46421353623827.403625067371006M,787651382989911.26613362998995M,78743377541995335.668872642251M,6870398155166417.6872386628862M,60966705189610.448298528638718M,788739403499488.34720181714545M,788739402577213068526.62247055M,3744622694990143959207397.3758M,44564514402342.145590608975102M,787881081847086.13586714689253M,787482136695534.11501996179160M,69632422415830237405937.308414M,69632469638198.016215500104190M,788908658832767.28157319200415M,78588631384595.558627978509827M,1544955216487676357157712381M,1235474927735.785162312382718M,785559901292067.61507953180147M,78599511514063.253521481924099M,7736888179003548.8640704850173M,1235479649237.602192320233469M,786055573790914.90850526854630M,78609183234208627491600203310M,173287521093655433.61251770110M,14852843697892.920088432869118M,786611669706760.57637929680376M,78707106262510885239619714566M,61680241696540460318289.0238M,2783140817821.411214710677758M,786176464897145.29235226394180M,7862127299046996006696864927.1M,170192765488168056510.34278398M,5877787855861.324894806346238M,786974348928390.12091454291457M,7799020539301359387793778.2268M,191829562167019018605808770.52M,21349417399807.022530521977852M,78059112449195967.238208355351M,780675737862244.40924536044542M,5256924128779784809147546.363M,70248450346461.711866219221756M,779212961047656132.70528162857M,7800954763427807826487404.0399M,15159849426254982964385157116M,33110102778934.758836769915388M,78040978654135749.515260263449M,78050649820880771444308048897M,34000471253362481670733337.56M,78604734507234.095528775797244M,780325175384363982.42933636167M,77987787928745010835178.912878M,386808046257714555122.44385788M,36204995383418.531539958103804M,78103842889006881.967847701512M,7814736486414257744960139.9832M,464236487113046863155667200.0M,78918606671395.719772997947904M,1209165619.124890382893052M,108800187841.34149195497455M,75823969075566.746144371377407M,72419487574675.316418411497983M,79174969685961.944131968237584M,967173859465128425376970.6M,959390780258424589504845.6704M,11450822582942040559162746368M,32641070916852834844671997M,544011638337.97543532691435M,5880281300529007189.674697215M,72729199258448.176678537530880M,79219700328670.436902188941356M,14506980716048329183133723M,52611790570026258383.96472320M,4642360149340413529117686784M,65282400084182047645237301M,7919914855285588494918615041.1M,188917725551417.88463616M,9905957055390029229231968909M,123794025120.7045815615684867M,38649405676796739261961339.20M,63279755.4581786291995650M,1145215428975350.4161313325312M,1813573196863952235003908M,39626170515504870401008141312M,30948501618583547581680844.80M,39626170515411636079672283173M,39055760794746205638293192.704M,34055440338843600949111422979M,78918678095317240.574914855550M,1208909681073185877.880575M,218010924579800053.4212862047M,154889041056894334.43837034527M,618970077721116.636054814762M,3038207.5719812206694658M,34357671794058845699369479178M,991079275866989292625.4481408M,309485223078714282627563519M,387157205771334.40952978439M,999543308285.6123975607189250M,3872371933.6104979196805890M,24178539473428457455618.56M,77891854621918.53503062216974M,6166561152915580349426675.43M,3614782294903610.24484476684M,322783525172399646937073042.14M,681964263459253968.2355019809M,26048795822835257178508888595M,68256770827494490872007906.51M,5321894816222175237782831614M,4972727723809099288.452006526M,5986647882399331142779013416M,5987299846898374484.856539665M,528067946392354933546313754.6M,15508171564194664142058146349M,4679160633392910060646970615.1M,3219740181986995212003941556.2M,342494387337634888345039950.7M,970084743205685286267055975.4M,3538544763480338121499040536M,3729616473761747818387409408M,4961630050822864617241379592M,30948503035744271018550889.6M,58789773364012390547161M,415760456472221054.7514933773M,93108557206.2449900666882562M,9911224467746160883962480426M,123794026950.9978386909036291M,13328499607856644662247.816992M,945372467770622021611489539M,3094850396246474378139144721M,4690717496296961915351142673M,945370898063187437532809728M,369285441669192061406848.0M,465441162918520864647.417640M,309485037780.3108017015488770M,71181696511009685084654190.25M,55941157611843393578.34674193M,154863397502834650567.05188369M,6238860769383419.79376587529M,12391489652379361952812893950M,557073019049092228248259788.8M,6807569139204299755779M,632391961048590209639684661.1M,66774304534.1602203767540226M,526608087085.2409088872351234M,5407756642943328360192110342M,309485050692413072754.8170756M,6820759475934.321491637571117M,50001173016149.03325209209601M,200561826802.1759586170243586M,1580799701552.9477035909579778M,65201620522734971208090.91609M,134983526244448939249.31566338M,62886026454854871910763008267M,54511412880532890374960595.15M,157081063257008373518520576.7M,7922720031436728483080221952.5M,1161702600671982648951807M,623805723532797085950672899M,115384672978777397624068M,2953847642555634.6854380575M,12379401588295031205741880.32M,89737052432722221477.80542489M,472467682821148.7703041M,16240624240085821066051.596M,1570498606904585324504418816M,12584920733667704338372362.56M,402943025879904.2289857794582M,12389886448173.26826752910858M,44169465010339.998978147359343M,5268720673137.134791474164223M,4330576141266078356173954820M,7629645406486818075878.4M,4690660827898604528648521994M,7125489599093169295895628288M,17113856209915664998470488M,5262454092860728672378171914M,79227436303137.319052500871687M,37789813947774.380374749151232M,1067481612864295641413650944M,2934073941604118774090302464M,4949276.1279701013431298M,2624589650339678728416014852M,669848836195964729944900608M,63110650150575751345.6289915M,295292267922731688.26250559499M,152518187501913094459274M,14351663679412186048811199231M,328817216070395212641952.78339M,152518204.999635680822633M,151319869733306133774339M,438840076209462728350578636.8M,71485817316026235084163018.41M,37658133375251572.13774480407M,68100822404035382346970757.19M,386252753165075.5039335224835M,4566157878708.7345948440265730M,1241576467856337355523491667M,47246841.54424950663172M,38761162834685281720663776M,1025229539530402560914227.2M,6407779080643634740583475.20M,12379401957230064629.14461710M,42960539817902.044816567442543M,78918677506770.235510709554943M,6251806011772678372122320746M,328066199668191481334679502.03M,1527246854925795201832947158.3M,1255285734460235428324.841733M,1331754179192407619038.0854290M,123951967088870557.98356480790M,1579832307542164134027696.5391M,349838953691002.76333950406142M,40438569045126815781727764.49M,183231877824821797.33323791M,309485037563.800248327932416M,399405716931257.84859848999437M,20741057868455511641292801M,78624989051708408807118088970M,4033633866233301494161998349M,72865747362.32576058884100M,133078554436497005404688890.88M,151209336463417348688592M,511378532499381885337.9M,68075691392042998868.50M,3436258785074341406506326912.1M,2757244818245958338037533.9008M,12391576278618585519372985603M,529411761604366738963182.3872M,27571996643149019542184723465M,60023450285867.00993916835588M,25911773691563331657859593M,4337715732990134307344945418M,939417173871109780378489.349M,24927978494191.92181941338253M,97374838156727466122383.36M,263595224844857791204.15834135M,713637902261578904263039743.8M,1254987856075523114346425.104M,2005617881214904275406164314M,2005619003944919579242398720M,497236464667.0794590168679426M,2005621072432665998799362071M,154012952019359682397184M,38690644395397171714916354M,5986709403514365654087172097M,68472396720821.795161666687239M,16639826105735.49530524418047M,331136871250733219346635.89738M,79227104815140.869665028461920M,13003289297405607486629216511M,5261245259196587554776559635M,632258943392950417231055614M,2469763888019715699775272M,24697678432346201821094.80M,6322590378875613016.40609822M,303683649443779169365198868.48M,80514459591003996.61450204722M,632261476940001727785994110M,9722601862961118575197163560M,6567139128457907780650188033.6M,104629932679641592.629866M,137334445344935340260612500.58M,303490203534340925.55556948734M,2982915863916738876171885235.0M,29818202564468.426995340606991M,38069263748404921406670774122M,27244777357605725882269.564928M,284706752886182798299516072.3M,382031435271807396.9351743752M,13010459673009857832751864328M,7.2058978264367619M,15842005632942724492055019532M,147574037.0321694275889M,47041721550922871782489.718786M,139514909743529458344.656898M,3350433544762.7138005668838915M,309485046714.833216143884386M,15786125018328939380860946007M,928455030833129492911751190M,472236.6489466714983427M,23611832415447737704448M,18446744082299486212M,4294967299M,185710369497707949088518963.2M,3095043748241633009830220288M,12090014682664225565180475M,120958621364356972505991.35M,39304643496772962.683059301634M,53231450049266897391093638656M,1209110421321258034135081M,634686313652865424677.273958M,31567631562958584150117.845505M,48898631579443030594712242689M,51473909.9555395463545093M,189801353684000388646567953M,1330785542599.2782947899414786M,17331160551364469812354880256M,78580178361363993378947379M,88251584837216250663796739M,928832818782668077601390.592M,1417315.2286508171938051M,66259500509311577707755095296M,16199605982837697388380160.1M,7118155225891.4533511366968578M,358558589032442451713M,67884018472816320970886M,2772973605.9502243379447298M,649919465105.3308259455763203M,32188632200332726558619877632M,142663908938230792977383444M,16562957035357670813925377.2M,3249661078072233528405907737.6M,5261986620149979253231995392M,20554875010545736055587085M,338534094744746107685.43804M,3249605827191454.2953276686593M,31568080202978725650541628416M,3469620238941362120966146.27M,4642276807912773390.10466041M,11453079878300436799.885940992M,9596226492381846843619809537M,421918800396854187105517585M,421918468355461770.855383049M,928455250824965196.139837952M,29712256295187005274450854656M,4835703442840822231531630M,1208935044112587411.161696M,0.0001099511655692M,43.2345564227596039M,43.2345564227605001M,115226023.2066360911497737M,3479461943295.3992047433372420M,1592449170290322683229185061.0M,3413200407009319196506.2791218M,3354213923557306226902356.5361M,3134382107754376240298.6583404M,3444767724790005010471841.9276M,31086778647463915672455364974M,30470263430838718420393157959M,20735974450869090668590.031215M,320104168108289189492.40075109M,31385255639674300964829.003877M,36039860545984443.823381629028M,31877434988907235868610.030949M,313853028637027953394447.39956M,23945743374162168106567.624035M,122632650964.568024808449398M,34480323151215090914473.305447M,301240154443830.83018859145552M,2954179018716104057842758.1804M,36022849058114875380.314751859M,30113135112363194381341.119071M,356794784862315453.55917282661M,1226608001944196045975.98295M,295417901871610471324308.85998M,357121902264801113425846.21389M,360228490582578514484569982.45M,3413214708396707426463680.4191M,31877463341549470371079742.824M,36039860545986687994712.519781M,310711520810712260478129.27597M,360228490587625361074701.88368M,133507968135.380435580515145M,3138250738854608269109.9097157M,3108200883850968044410878.7039M,357182060233892549043471.16915M,2611938247998853924717792.1141M,3139025630433324526117.6569967M,344935408290688421536026577.92M,33875679592440250089495.265394M,143685624732777231738021.74834M,34794619436283292344461.981010M,139505262097502687.254963564M,35724237077115841087389.132109M,30158342526881962240.347696751M,33861353113693829487542.626676M,313865963780756010843324.01992M,2599729048860705837987.0860387M,344343604129951691863110720.97M,3443317039509213101600.7249525M,3014753290309703186560367.4880M,3138250759045399205927.8354796M,14675837508511196324242.0831M,3541599849223984878137.2422483M,2485589321707305720.072044544M,9914462370118834960455436296M,21676045850830012025851.10536M,2485688544653744115619988000M,629944910605804396076.993300M,2201482307926851979153768960M,18605985596257848942051348.54M,6198356610455849324320852765M,21761042728380674.30231244802M,2486770446336356289146390804M,24855657817177277335.01599750M,657684182992450806098166539M,34069041684300836.45326373137M,657684073528299176610629640M,37847445030441857978309044.7M,5899563312816281102447674641M,378474449232287982516437768M,9909588868897426395477049363M,3784744492238349760447191.05M,5262501390242731399895646238M,34237302735231343134686.00325M,5262723582781289166965642504M,24855893751746144757783.63656M,55719438253328562242112734.83M,21760904008215165654967.27312M,651255915226890271888507060.0M,62866535171479122182307871.3M,2172520126158312689697359880M,21724870691673393151.53346564M,134744579M
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  END ENCODED ASSEMBLY  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        }) {
            //Get the bits of the decimal
            var bits = decimal.GetBits(dec);

            //Skip forward if the highest scalar bit is set
            dynamic idx = bits[3] >> 16; //16 for skip tokens, <16 otherwise
            if(idx == 16) asmBufOff += (byte) bits[0];
            else {
                //Accumulate two 4 bit scales, then add to the buffer
                //Note that for even parity tokens, the byte we write here is immediately overwritten again 
                scaleAccum <<= 4;
                TinyBot_asmBuf[asmBufOff++] = scaleAccum |= idx;
                asmBufOff -= scaleParity ^= 1;
            }

            //Add the 88/96 bits of the integer number to the buffer
            idx >>= 4; //1 for skip tokens, 0 otherwise
            while(idx < 12) TinyBot_asmBuf[asmBufOff++] = (byte) (bits[idx / 4] >> idx++ * 8);
        }

        //Load the tiny bot from the assembly
        //We can't just load it and be done with it, because the byte[] overload doesn't add the assembly to the regular load path
        //As such load it whenever any assembly fails to load >:)
        System.ResolveEventHandler asmResolveCB = (_, _) => CurrentDomain.Load(TinyBot_asmBuf); //We can't use a dynamic variable for the callback because we need it to be a delegate type
        CurrentDomain.AssemblyResolve += asmResolveCB;
        TinyBot_asmBuf = CurrentDomain.CreateInstanceAndUnwrap(ToString(), "e");
        CurrentDomain.AssemblyResolve -= asmResolveCB;
    }

    public Move Think(Board board, Timer timer) => TinyBot_asmBuf.Think(board, timer);
}