using ChessChallenge.API;
using static System.AppDomain;

class MyBot : IChessBot {
    //TinyBot_asmBuf either holds the TinyBot IChessBot instance, or the assembly buffer during decoding
    dynamic TinyBot_asmBuf = new byte[8704];
    int asmBufOff, scaleParity;
    byte scaleAccum;

    public MyBot() {
        //Decode the assembly
        //The assembly is encoded in a semi-RLE-like format
        //There are two types of tokens:
        // - scaling factors 0-15: regular tokens
        //   - the decimal integer number encodes 12 bytes, which are copied to the assembly buffer
        //   - the decimal scaling factor encodes an additional 4 bits - two regular tokens are paired up, and their scaling factors are combined to form an extra byte
        // - scaling factor 16: skip tokens (can skip up to 255 bytes forward to efficiently encode a stretch of zero bytes)
        //   - the lowest byte of the decimal integer number contains the amount of bytes to skip forward by
        //   - the remaining 11 integer number bytes are copied to the assembly buffer
        //   - skip tokens are invisible to the scalar accumulator; they don't contribute their scale value, nor do they affect parity
        // - the sign bit is unused as a minus sign would require an extra token
        foreach(decimal dec in new[] {
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BEGIN ENCODED ASSEMBLY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            73786.976307732568653M,19807040628566.084401472995583M,31105283551.3167525259001891M,594328925184M,147463285637180333097184M,7737125245.5336267181203469M,73786978493861462528M,4110347786.6897391940011012M,41277563240262130762296328704M,7555786.3725983042899970M,1152921504606846992M,0.0000309237645936M,3775059766.4188004285296132M,9444733000923662516736M,0.0000412316868620M,3088427715.8257648910485657M,1099512131072M,944473.2966838802055477M,113640539676789186605613060M,1136405397032481866098.93458M,253782147137085114486609914.88M,19188552296141429730353110528M,128148110699625849560957030M,67701450782042557441.900638M,294014159497557021822487301.12M,28782648991943840730045240576M,124520835189950760495743046M,1051783725586247621517.64045M,210454198520417610646.23298048M,31877461311153407149993917952M,119685463949226554786644067M,107597865954980.428919799919M,464234456726761390344870574.08M,55088624547603614351900051968M,304651944502443839004344500M,27322107222350963871.7636785M,2537821471370871705715087.8464M,25378214713708511448660991488M,99133651225423872846331998M,337294546512565667927425118M,21678542986558909054515404.81M,73968371851815038432705592833M,333669687502439385779208476M,311908819832376628912521.552M,287834187549025.03676482481409M,30330905196791160740551661569M,39169674335220953191297871.0M,423129515647471950801207.559M,89767559134934287804300935.69M,8667252011756163248938895617M,36631142251080480030870768.4M,3179541130211177276786610.14M,451861856695127222499557378.57M,47661976029749627819107885569M,35784676504672353002697549.4M,43521844180785433371063118.5M,70873578424881718928485748481M,3715251012410718361038662144M,30707158547106395425898524.8M,331251798944670299058.733378M,2971193989865023815.5103477761M,27236059818782448609237475329M,46060588402173198717793103.2M,4666509189459230106822249.30M,8976788968041207229749235201M,15785530022130072971064212481M,35059555287566686808375333.9M,36268471883555937475.6905335M,3744912181654487316.1211065857M,32497286099377874136629064449M,50170991529207758909564547.8M,4497260681602269582219021.30M,10214903736976105.217208707841M,12071804350955098680770795521M,36389336795570193283357123.1M,367519850265514650902.790483M,39305937429944701842414968065M,34973142563738307639365412097M,41104010987033624220080565.2M,43159168279547318235267101.0M,93071235768096041391579392.1M,75207143048498302853440466434M,61172445230367390424288504.8M,62139650450226.3042778202573M,46425117412749357.855369459457M,63446844897585559411227753729M,57666693169704552323796223.5M,533145436160089080337007092M,1240187923201686407324222.210M,76754563375166462444546680322M,62260539342951540726045127.0M,621397113245099147739857380M,66851189450713612175836053762M,311935954271494870524888833M,6504114804923361682321577.01M,615352889972862374453772795M,7830233788061797.5107165492994M,930915419872112254042382337M,6407400739354191477214417.89M,633486094743.180717501383184M,73971181718023047.465924691969M,74899589524615324024501931011M,1178719571621624972854166.435M,12524639912843590987.95950975M,4488023775153134172.1955992323M,47046495870499824781794475523M,1138826993363855145452766.211M,1143662991790781847294772220M,76756834868969609194341.903620M,78304274086905236872050752259M,1206525658690638217675539.402M,121982386114948.3964593210283M,696389582610439735989231.94371M,53855151920334643421304324611M,1188393523826691457426719.752M,11424548591817.25530859439161M,623541343897905022.361638659M,8979603556976454402593509636M,123916606551738580476880.5830M,1310493352968694.673176396734M,58188234846717201694958300.419M,72729038696330.450939479585027M,79212445980539.376163421028298M,79195521554016127393670365208M,6592037320046557929242.4664320M,2785341477208215113928019711M,79202775035155282981448515567M,7919189518238537168284300084.3M,73966690673133803243269255424M,7736941074826033283437953023M,12088649460347069796188114M,27804943361.028676979654605M,7149116477046405132057995.4943M,76442816312744.119754815447551M,79208820125426.180245037776906M,265971981366940988266250.39M,5570730175919551.994663004672M,5570692399149377276237310976M,14506574886552648754331644M,79206402163096.072000351174591M,61904557512850445248233036.7M,54159437532815.796341280080896M,79130237807305.553902853619618M,7913023780730555390.2853619618M,15467544538986014403680862.71M,9593057757305.756713765261311M,79002092002411.783115513921420M,79034732317040557664692.535207M,6034875049338952.0714403375871M,52302414136155.269586355179263M,79115730734357.192554235690901M,79162878490846973488.957095838M,526120124830604877781993.84319M,49517171829940.278706072165887M,79107268511876.277691467694023M,7911573086348721593.5934758834M,649914506563593453.66761449471M,61277554981215.929485009851903M,79084298626153.442538940137368M,7913023780730555393.2919832480M,504456740824926884533475530.23M,50445674082492.688453347553023M,78905373749442.403338377363286M,789222998730599138.21440966368M,671570429088274.01906326284030M,47349893657977.852389102645246M,788425104553442.41004912967408M,7877722838728315.6556587138843M,7458369144642509.6641333587710M,77060223214452.840944623314686M,788630597408722.67942068551326M,78879985347986011340.342951562M,49516307618499034662.815332862M,48587748695242.946788099807230M,788497638995856.86337803189974M,7880986903393812.4852508032766M,779885176807182996957.46555134M,77988886028114.260273624170494M,788920749566747.98941438607035M,7894285017314507329037428290.9M,646811533844427589286.67706623M,60348339632949.753911252547326M,787832726105700.30226227003161M,7881833134866064.1533499145964M,742747211745504.38240040435198M,64680733092816.811187909864958M,788860287042581.80497549819552M,78867896200472863143601.372801M,349704129825879.52766969110526M,46421353623827.403625067371006M,787651382989911.26613362998995M,78743377541995335.668872642251M,6870398155166417.6872386628862M,60966705189610.448298528638718M,788739403499488.34720181714545M,788739402577213068526.62247055M,3744622694990143959207397.3758M,44564514402342.145590608975102M,787881081847086.13586714689253M,787482136695534.11501996179160M,69632422415830237405937.308414M,69632469638198.016215500104190M,788908658832767.28157319200415M,78588631384595.558627978509827M,1544955216487676357157712381M,1235474927735.785162312382718M,785559901292067.61507953180147M,78599511514063.253521481924099M,7736888179003548.8640704850173M,1235479649237.602192320233469M,786055573790914.90850526854630M,78609183234208627491600203310M,173287521093655433.61251770110M,14852843697892.920088432869118M,786611669706760.57637929680376M,78707106262510885239619714566M,61680241696540460318289.0238M,2783140817821.411214710677758M,786176464897145.29235226394180M,7862127299046996006696864927.1M,170192765488168056510.34278398M,5877787855861.324894806346238M,786974348928390.12091454291457M,7799020539301359387793778.2268M,191829562167019018605808770.52M,21349417399807.022530521977852M,78059112449195967.238208355351M,780675737862244.40924536044542M,5256924128779784809147546.363M,70248450346461.711866219221756M,779212961047656132.70528162857M,7800954763427807826487404.0399M,15159849426254982964385157116M,33110102778934.758836769915388M,78040978654135749.515260263449M,78050649820880771444308048897M,34000471253362481670733337.56M,78604734507234.095528775797244M,780325175384363982.42933636167M,77987787928745010835178.912878M,386808046257714555122.44385788M,36204995383418.531539958103804M,78103842889006881.967847701512M,7814736486414257744960139.9832M,464236487113046863155667200.0M,78918606671395.719772997947904M,1209165619.124890382893052M,108800187841.34149195497455M,75823969075566.746144371377407M,72419487574675.316418411497983M,79174969685961.944131968237584M,967173859465128425376970.6M,959390780258424589504845.6704M,11450822582942040559162746368M,32641070916852834844671997M,544011638337.97543532691435M,5880281300529007189.674697215M,72729199258448.176678537530880M,79219700328670.436902188941356M,14506980716048329183133723M,52611790570026258383.96472320M,4642360149340413529117686784M,65282400084182047645237301M,7919914855285588494918615041.1M,6327975545817870.27436032M,1145215428982556.1755351253248M,1813573196863952235003908M,39626170515504870401008141312M,30948501618583547581680844.80M,39626170515411636079672283173M,39055760794746205638293192.704M,34055440338843600949111422979M,78918678095317240.574914855550M,1208909681073185877.880575M,218010924579800053.4212862047M,154889041056894334.43837034527M,618970042340836.863920570410M,6933315681121.7356870652989698M,6820806697932663299151681822M,38517378384.625498393144M,2833759901409250709564715274M,78621281753549628700408809984M,78662594786417944468582826765M,94537235600702.0881898897411M,4330511012443728084877518848M,30396170238229053407537014.784M,38069277914999091459755388216M,4331068097411234046541.037568M,15681187025200851331302.03139M,7124280135219362788.701118314M,12670161169109323314697048M,3094850396243662986751126532M,8670415979031320045480.317307M,36331990236.959M,5704939832230598028527599680M,6810082203648532623376845312M,29829168083900.336908823367166M,825499003.05872898229005M,1258510667686866022.875488266M,12585106676871474994293.06222M,3276569037559077107062821.33M,123830602268777202310.38418950M,945380086636473102656077825M,34357671794275018373739840256M,13879075019255821952352277M,68382227222174268550916M,4815804986178777459283985924M,29530426273360099491810312448M,22334914817539055289225977862M,527100824226639325850.0300876M,38723722153835116820963336M,14236324618890337838825340930M,6166561152915580349426019.97M,3614782294903610.24484476684M,156620372575386750561558M,5906859130377866028649545856M,13879078051599932541119246M,7252355401296864799483695364M,1176967.6077608174029314M,114075823155216517107972M,46185720100622946.5124051240M,497238776825.9366320820257794M,466378163554437196670575669.5M,2726859722600070789697.3661016M,15193926280012604980497288723M,960499612138100004090092.5471M,373479705546858259278360681.6M,634777460652.770673801433368M,160187393465940096548916722.7M,248699186282503786484068481.3M,1209516191995158161666564M,38761162834685281737440992M,3553042669108609895953858561M,950262917889649196768822272M,9995432508119170452828456.488M,2953042627336.0099192645287683M,79228158382627136546998518.292M,3811868257801073369823362508.8M,2524322427547546434713.358867M,7870372986406.4657985355909634M,755625860926267788516918029M,2524322427547546433285718272M,309485024867.5899501048629762M,4330377008226789364691108465M,3027388631450691612186.112M,30948506176110624502163704.32M,9453708794771345.19392407828M,62389562393511015601760870.4M,5886987567586148995893035136.4M,75562586092.6267732682543619M,187748068733.0682060265423106M,71246768766229569215492.33519M,138790724965042939.69363752M,936997974899020593653416.960M,314320724268686702318918488.9M,5268390.2778749150366210M,1873827073032707323362940426M,14907363803515245112409984808M,27260150247295059395.908893442M,1578876009884461279550313.489M,15788760098844612806053.11322M,651983647171353816.4969414035M,2785981836833466736211520361.0M,712428015482087328587039464.4M,3094850211777083128922051.416M,7480726571.001704844623668M,3555465040704540274990252303M,34357681311967716910355842048M,1237940288125888834289270815M,200561757051242521132060.6575M,904337180.6660070896698370M,10252297626274704366371840M,4724684429302910424836M,38761162834685281737440992M,680996420062157830049044889.6M,126101848568350619004306110.3M,4951760765879571932921.333011M,372107367314538114424059110.4M,402943009551796041203410867.7M,25026985092280177911998711.98M,534957886247993935367864M,133151991132293597970941230.55M,123914896516376754.62194433534M,5261250147444773545320644623M,9027053817429606154893.264936M,12750024940239757722926.25M,25217073180540682.12989958M,17336087603208904809970.204928M,145071098353768699416.018943M,7480579069060585.720156955M,7861444419064667005.3693456388M,1237940269510047530071.493124M,1917375239378.527773050011681M,1237940251063346285691.019891M,13879075019.255821952352277M,17505850240934206786962432M,4815804986178777459283986180M,2953042627336.0099491827155202M,32857405151464787625868533767M,6758150887804969815.79669324M,3261127455516797909092010269.9M,4972534695850173535045554.448M,151412103482908956688416M,6812289472735486765926526.464M,78635802993104659536593748478M,479098256111478905654044292.3M,4566157878708.7345948440331266M,1237940232766215097384962131M,149052613869941090.67286M,7743169874668073933652503.046M,7581995911535042231418236.13M,157693118825990539880012428.3M,12379402510632308771.07165784M,38069084983236253362109293423M,1240376780393212103.916519424M,4440465135688996665474483301M,2434999040771779004.6231M,2757199005741944758944.9590022M,1127567000901480.9264396435465M,278799076091.2152039128631810M,9979607479083591540778M,12490290412418742353890.5M,6813590995731730600038.765322M,13938914700600.283423181897755M,30948507887425002528106747.12M,1310477505078954.3989559825922M,38720442943616310598192136M,1237940324850210608037691136M,55943965077558620817760665.67M,6409672642550334.65978946592M,6233857096959626861413379M,13330915152629309610186712582M,30948502486750737547645415.44M,49017851505979674.74851855M,30948505486015609233369166.5M,3094850248675073754764541.460M,755625860926267805411839486M,6808689363646106309402624256M,309485056015.911081218148392M,52868358554010.08471339959309M,12379419540435402869614057235M,1567986326377099623597.211648M,7922760911424965816610560513.4M,6818431347805855988273321.478M,12390361080544556190455564563M,380691216338896964129.55443200M,5273334427279937477780963339M,2757199664314566315806.5177132M,3126523954724509995843603764.6M,645788413483331653796040.971M,5677224338160263802493560068M,13879072784734.670121076008M,5274623815676310072566285312M,4690679736175218519807.430193M,526124518895.7887144515537410M,12379447874628933294053327883M,1348707939959015.8645460992M,1148588105345356600314368M,7143632577533475718167137790M,4364241098276566898509026835M,200561788121659312526682.1466M,200561900437.7265143469966338M,682927470559.8865002517365762M,2005621072432672595969792023M,3553045326237273979015005184M,435586386131.3714043682227202M,34983895368595874275264711979M,52660808708524091232255344.64M,78635794378229649536654454029M,433082744284330.3796340686863M,3094850420673998757063.819279M,4353740180208795167106273935M,38069891952056731732955846679M,944704082860748.4395520M,309485035935018253591235818.7M,38078745467601943.073868636258M,23256110714298328495696117777M,133176165539820448387521.80741M,249884968759021776676343427.4M,125974351958540190677.1592979M,5272125499211396028672509480M,29829121255256736546732.207825M,38069477238578735864057176071M,42824279897502.936549764104192M,677088183959195482839385358M,1238091191906320250965065809M,62380572338.8679689977695490M,2317515518572948578277523488M,87603587610445244138496M,3094850121277554259.38963713M,3869514474762.6097769709583M,123794032499.4022110588109058M,1208949043080600597037.098M,1491715380585.6252695343533060M,1475740370321694275.889M,15901093530.226422448910M,13951490974352945834465.6898M,3350433544762.7168791994442243M,9444732965739290452591M,1578612501832893938086094600.7M,350488137404776453632M,309485010253690633204006.912M,2361183.2415447737705731M,4722366485068668470272M,12884901891M,464227533180450526656987137M,309498705188549648.5216853248M,3096663530609781215550631168M,7260638526803325373710975M,7263294964910430.722457609M,495176488227502.82246919389186M,14855346586645247688276188416M,6975503087061919315445681.92M,96715173454696963.68312832M,45184811461586918357216527873M,45807070.1760959720980741M,44875326425247958668824024320M,1423631045545.6818154124090627M,71326623362611360613531667M,82206955820207893787967795M,928813929316736598953426.944M,1417286.4056132020227075M,14173296401696247796480M,55362750219265704026M,67884038457449473310814M,18077218968483703901688576M,1962615517.4869337104221699M,2338515889.5245669322229251M,2480186884.0114265574729219M,3043092968.7704772167108099M,773713469033.8696239309686275M,35283647581373088679254313216M,154753812770419707510718484M,1861809034617520501949071.48M,1114226790525862173672380.4928M,5262085766499464545369683712M,20555096293787479756112282M,20555096288720930175582357M,43947367256874963.216963255041M,68396267463574039569687924738M,472690456693093732925374655M,918788235249.00232989573298M,7706466225703388.0624697475328M,78918904179835790447016418304M,334877635575375014957744156M,1861804238478141227901.91129M,4240017362318122348141199001.6M,7737965859121464726492672768M,1212209439701998607401396M,3421300468275801834347.59168M,22283666851633736618877215.745M,12379636511184631262.61989378M,65536M,0.0006597069791492M,7.2057594037962247M,43.2345564227592969M,2011753150540.2642057096508169M,3683374859.08736M,15536455536805590460904923.504M,36033589280174829503188129.024M,3355540504209422469676472735.0M,3602269794036018329396126.8837M,34177912319597567.130447472485M,12143272909165592059552.8769M,3447186055669601637228.0357989M,32267440921618594532801.409633M,313830266826231524058483.55699M,33546979715547745160420.217344M,3139876669721360367488797.1144M,3138250722238127083131.4644589M,3076161481162450084804803.0559M,3444637415022462359761.6976997M,31877435045391372422499.356773M,341780398426573915086105.77509M,33542052996034888840318772585M,26112138442911583587641.091445M,3187743508056478011291109976.2M,3016202544044858187553.3837413M,360361201448608336749510657.01M,26760032606229903205854.442101M,3140116484905731219375819710.0M,313987191602746948819545.88416M,3444644941358389612944813.6047M,3262700197782319267073.2838262M,34170748378952460834104632.165M,3201041621960170474792.7039593M,12982444761469072636438.1288M,31877468027012803044733.184084M,313987666972136124411822.32436M,310711520810712260478129.27597M,29541790187163572685524005743M,13350796813538043558051.5145M,310818842314008550169487.20504M,3538284292587040592773.1680111M,36022849058763393589.217684307M,3108200883850968044410.8787039M,26136265067271850049851714.629M,3069462867025287272847.6283509M,3754802914237074525322113.4959M,3076649340416019273503.6666995M,36033797012290588622999606.016M,354039045880039466814976.44393M,34485087383953841818262991.461M,35724284097517715495397456242M,34178039841649981563241523522M,3354682444987822366849.4073971M,21973985325362937492361409125M,33551778450295432121814.119525M,140757021674843568.023955310M,3445317908103672662639.1966537M,360277191572948855564162172.04M,146740204884006058853.163369M,3134920535191277423647.3619557M,33856332056959933153054.752889M,3096059024249.238098536331634M,9910811815378555739335361056M,5586531382282167000781817.864M,9369932162177374970529733.29M,2470167040028583426982144M,9444879636218293256194M,629987411545864480599314.694M,557799813990774945049752576.6M,1394757113003378834505341491.5M,312054069421748723326325767M,6576792577033355779.61891592M,2172491792029498446075922441M,9907189906708364917501265.928M,312054088661411178297493504M,38699940906.434953778432001M,9908389076433622186638443522M,9285783147400523449862468881M,5274552980539636000524145920M,2805954754624290441.650374413M,15185369205411700731239663624M,34140444965908884896046776.36M,27878257549978137078237107.52M,310845144178613542498407681M,1568076106107416215101442321M,248684083940475812823413787.3M,5270949833578069474121616136M,36268330080714992.191604743M,248558483748977367950196992.3M,28059547359630656997950.10833M,31561030711082716298051767.1M,527095438992414702947120461.7M,5270949778238128632097081353M,0.000002055M
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  END ENCODED ASSEMBLY  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        }) {
            //Get the bits of the decimal
            var bits = decimal.GetBits(dec);

            //Skip forward if the highest scalar bit is set
            dynamic idx = bits[3] >> 16; //16 for skip tokens, <16 otherwise
            if(idx == 16) asmBufOff += (byte) bits[0];
            else {
                //Accumulate two 4 bit scales, then add to the buffer
                //Note that for even parity tokens, the byte we write here is immediately overwritten again 
                scaleAccum <<= 4;
                TinyBot_asmBuf[asmBufOff++] = scaleAccum |= idx;
                asmBufOff -= scaleParity ^= 1;
            }

            //Add the 88/96 bits of the integer number to the buffer
            idx >>= 4; //1 for skip tokens, 0 otherwise
            while(idx < 12) TinyBot_asmBuf[asmBufOff++] = (byte) (bits[idx / 4] >> idx++ * 8);
        }

        //Load the tiny bot from the assembly
        //We can't just load it and be done with it, because the byte[] overload doesn't add the assembly to the regular load path
        //As such load it whenever any assembly fails to load >:)
        System.ResolveEventHandler asmResolveCB = (_, _) => CurrentDomain.Load(TinyBot_asmBuf); //We can't use a dynamic variable for the callback because we need it to be a delegate type
        CurrentDomain.AssemblyResolve += asmResolveCB;
        TinyBot_asmBuf = CurrentDomain.CreateInstanceAndUnwrap(ToString(), "e");
        CurrentDomain.AssemblyResolve -= asmResolveCB;
    }

    public Move Think(Board board, Timer timer) => TinyBot_asmBuf.Think(board, timer);
}