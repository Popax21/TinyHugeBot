using ChessChallenge.API;
using static System.AppDomain;

class MyBot : IChessBot {
    //TinyBot_asmBuf either holds the TinyBot IChessBot instance, or the assembly buffer during decoding
    dynamic TinyBot_asmBuf = new byte[7168];
    int asmBufOff, scaleParity;
    byte scaleAccum;

    public MyBot() {
        //Decode the assembly
        //The assembly is encoded in a semi-RLE-like format
        //There are two types of tokens:
        // - scaling factors 0-15: regular tokens
        //   - the decimal integer number encodes 12 bytes, which are copied to the assembly buffer
        //   - the decimal scaling factor encodes an additional 4 bits - two regular tokens are paired up, and their scaling factors are combined to form an extra byte
        // - scaling factor 16: skip tokens (can skip up to 255 bytes forward to efficiently encode a stretch of zero bytes)
        //   - the lowest byte of the decimal integer number contains the amount of bytes to skip forward by
        //   - the remaining 11 integer number bytes are copied to the assembly buffer
        //   - skip tokens are invisible to the scalar accumulator; they don't contribute their scale value, nor do they affect parity
        // - the sign bit is unused as a minus sign would require an extra token
        foreach(decimal dec in new[] {
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BEGIN ENCODED ASSEMBLY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            73786.976307732568653M,19807040628566.084401472995583M,31105283551.3167525259001891M,729227589120M,118465003953308917956832M,7737125245.5336267181203469M,73786978493861462528M,3384992294.9209616891773956M,41277563240262130762296328704M,7555786.3725983042899970M,1152921504606846992M,0.0000309237645936M,3032703755.3116922009366020M,9444732994326592750080M,0.0000412316868620M,2568967402.7101039175420057M,1099512010240M,944473.2966838802055477M,113640539676789186605613060M,1136405397032481866098.93458M,253782147137085114486609914.88M,19188552296141429730353110528M,128148110699625849560957030M,67701450782042557441.900638M,294014159497557021822487301.12M,28782648991943840730045240576M,124520835189950760495743046M,1051783725586247621517.64045M,210454198520417610646.23298048M,31877461311153407149993917952M,119685463949226554786644067M,107597865954980.428919799919M,464234456726761390344870574.08M,55088624547603614351900051968M,304651944502443839004344500M,27322107222350963871.7636785M,2537821471370871705715087.8464M,25378214713708511448660991488M,99133651225423872846331998M,337294546512565667927425118M,21678542986558909054515404.81M,73968371851815038432705592833M,333669687502439385779208476M,311908819832376628912521.552M,287834187549025.03676482481409M,30330905196791160740551661569M,39169674335220953191297871.0M,423129515647471950801207.559M,89767559134934287804300935.69M,8667252011756163248938895617M,36631142251080480030870768.4M,3179541130211177276786610.14M,451861856695127222499557378.57M,47661976029749627819107885569M,35784676504672353002697549.4M,43521844180785433371063118.5M,70873578424881718928485748481M,3715251012410718361038662144M,30707158547106395425898524.8M,331251798944670299058.733378M,2971193989865023815.5103477761M,27236059818782448609237475329M,46060588402173198717793103.2M,4666509189459230106822249.30M,8976788968041207229749235201M,15785530022130072971064212481M,35059555287566686808375333.9M,36268471883555937475.6905335M,3744912181654487316.1211065857M,32497286099377874136629064449M,50170991529207758909564547.8M,4497260681602269582219021.30M,10214903736976105.217208707841M,12071804350955098680770795521M,36389336795570193283357123.1M,367519850265514650902.790483M,39305937429944701842414968065M,34973142563738307639365412097M,41104010987033624220080565.2M,43159168279547318235267101.0M,93071235768096041391579392.1M,75207143048498302853440466434M,61172445230367390424288504.8M,62139650450226.3042778202573M,46425117412749357.855369459457M,63446844897585559411227753729M,57666693169704552323796223.5M,533145436160089080337007092M,1240187923201686407324222.210M,76754563375166462444546680322M,62260539342951540726045127.0M,621397113245099147739857380M,66851189450713612175836053762M,311935954271494870524888833M,6504114804923361682321577.01M,615352889972862374453772795M,7830233788061797.5107165492994M,930915419872112254042382337M,6407400739354191477214417.89M,633486094743.180717501383184M,73971181718023047.465924691969M,74899589524615324024501931011M,1178719571621624972854166.435M,12524639912843590987.95950975M,4488023775153134172.1955992323M,47046495870499824781794475523M,1138826993363855145452766.211M,1143662991790781847294772220M,76756834868969609194341.903620M,78304274086905236872050752259M,1206525658690638217675539.402M,121982386114948.3964593210283M,696389582610439735989231.94371M,53855151920334643421304324611M,1188393523826691457426719.752M,11424548591817.25530859439161M,623541343897905022.361638659M,8979603556976454402593509636M,123916606551738580476880.5830M,1310493352968694.673176396734M,58188234846717201694958300.419M,72729038696330.450939479585027M,79212445980539.376163421028298M,79195521554016127393670365208M,6592037320046557929242.4664320M,2785341477208215113928019711M,79202775035155282981448515567M,7919189518238537168284300084.3M,73966690673133803243269255424M,7736941074826033283437953023M,12088649460347069796188114M,27804943361.028676979654605M,7149116477046405132057995.4943M,76442816312744.119754815447551M,79208820125426.180245037776906M,265971981366940988266250.39M,5570730175919551.994663004672M,5570692399149377276237310976M,14506574886552648754331644M,79206402163096.072000351174591M,61904557512850445248233036.7M,54159437532815.796341280080896M,79130237807305.553902853619618M,7913023780730555390.2853619618M,15467544538986014403680862.71M,9593057757305.756713765261311M,79002092002411.783115513921420M,79034732317040557664692.535207M,6034875049338952.0714403375871M,52302414136155.269586355179263M,79115730734357.192554235690901M,79162878490846973488.957095838M,526120124830604877781993.84319M,49517171829940.278706072165887M,79107268511876.277691467694023M,7911573086348721593.5934758834M,649914506563593453.66761449471M,61277554981215.929485009851903M,79084298626153.442538940137368M,7913023780730555393.2919832480M,504456740824926884533475530.23M,50445674082492.688453347553023M,78905373749442.403338377363286M,789222998730599138.21440966368M,671570429088274.01906326284030M,47349893657977.852389102645246M,788425104553442.41004912967408M,7877722838728315.6556587138843M,7458369144642509.6641333587710M,77060223214452.840944623314686M,788630597408722.67942068551326M,78879985347986011340.342951562M,49516307618499034662.815332862M,48587748695242.946788099807230M,788497638995856.86337803189974M,7880986903393812.4852508032766M,779885176807182996957.46555134M,77988886028114.260273624170494M,788920749566747.98941438607035M,7894285017314507329037428290.9M,646811533844427589286.67706623M,60348339632949.753911252547326M,787832726105700.30226227003161M,7881833134866064.1533499145964M,742747211745504.38240040435198M,64680733092816.811187909864958M,788860287042581.80497549819552M,78867896200472863143601.372801M,349704129825879.52766969110526M,46421353623827.403625067371006M,787651382989911.26613362998995M,78743377541995335.668872642251M,6870398155166417.6872386628862M,60966705189610.448298528638718M,788739403499488.34720181714545M,788739402577213068526.62247055M,3744622694990143959207397.3758M,44564514402342.145590608975102M,787881081847086.13586714689253M,787482136695534.11501996179160M,69632422415830237405937.308414M,69632469638198.016215500104190M,788908658832767.28157319200415M,78588631384595.558627978509827M,1544955216487676357157712381M,1235474927735.785162312382718M,785559901292067.61507953180147M,78599511514063.253521481924099M,7736888179003548.8640704850173M,1235479649237.602192320233469M,786055573790914.90850526854630M,78609183234208627491600203310M,173287521093655433.61251770110M,14852843697892.920088432869118M,786611669706760.57637929680376M,78707106262510885239619714566M,61680241696540460318289.0238M,2783140817821.411214710677758M,786176464897145.29235226394180M,7862127299046996006696864927.1M,170192765488168056510.34278398M,5877787855861.324894806346238M,786974348928390.12091454291457M,7799020539301359387793778.2268M,191829562167019018605808770.52M,21349417399807.022530521977852M,78059112449195967.238208355351M,780675737862244.40924536044542M,5256924128779784809147546.363M,70248450346461.711866219221756M,779212961047656132.70528162857M,7800954763427807826487404.0399M,15159849426254982964385157116M,33110102778934.758836769915388M,78040978654135749.515260263449M,78050649820880771444308048897M,34000471253362481670733337.56M,78604734507234.095528775797244M,780325175384363982.42933636167M,77987787928745010835178.912878M,386808046257714555122.44385788M,36204995383418.531539958103804M,78103842889006881.967847701512M,7814736486414257744960139.9832M,464236487113046863155667200.0M,78918606671395.719772997947904M,1209165619.124890382893052M,108800187841.34149195497455M,75823969075566.746144371377407M,72419487574675.316418411497983M,79174969685961.944131968237584M,967173859465128425376970.6M,959390780258424589504845.6704M,11450822582942040559162746368M,32641070916852834844671997M,544011638337.97543532691435M,5880281300529007189.674697215M,72729199258448.176678537530880M,79219700328670.436902188941356M,14506980716048329183133723M,52611790570026258383.96472320M,4642360149340413529117686784M,65282400084182047645237301M,7919914855285588494918615041.1M,3094850121278983631.88212224M,99059570553914366041155203.97M,123794026965.3789889409122563M,120892585733230.2630289408M,5818638108483756626809088M,9598871007848253033340282884M,11806636783125015830284M,179905653161387891946311.1711M,123794010385.1799282669061122M,16495004197212411070998M,301309910614981216986.9062M,2953526668055829651238669619.2M,12495907851707.833050489971216M,15551768266828195.829756461061M,201810986457894.915413766M,5261245203856356592073322515M,6722099793723734304195889.87M,35104442202677556947478M,7922815838262713654.6931409418M,235293751916375959782429434.88M,78918677506750629297042489344M,3097040944273340531305286026.6M,23529715978373.764244437953087M,21869802223292857100942704.96M,618970610447710916825907200M,62453108394694417523838929.92M,9265297063971351.21648129823M,78613311800656213451628215830M,18774904841347125255246965.98M,131244577270169614985255985.09M,590684969328045054425982566.4M,72072310987889628707.6783625M,786358505733596535.22434424839M,249666873012457082778.2909697M,123976161846332.58720362496002M,249926542186138293707472896.9M,280875297834699479981657242.5M,46628980791096445258013775.53M,5174457541689023.6335157023178M,5444024879132718024015744273M,6005981565025882842.556602399M,5273414909701883828262932746M,7465534170993472255.912776026M,13822440482343971275412315M,2490444170554909503273643274M,3288663772073718836358801.95M,67159456057131713673864151296M,3094850327861002890421211134M,1624064283094.6134951164674M,9310855720624499006668825.60M,557556588060169690.3257920278M,6807569139204299690243M,66780407406122249944354417.5M,557556588060.1696554969269762M,6807569139204299690243M,156803436054602697874919051.1M,125849679609833626590951475.6M,309485035935103571430.3431512M,284097681756266637209870130M,1237940177420634742574809856M,22284921364879238726747138M,5704939906014353282860588810M,6932464221843.7058053778901506M,309636420613668058106502398M,34379437512827980668686070528M,681359606952929270800003892.5M,19342815491717077862973.957M,5275780610998308838439257105M,687214121416492222897609.02669M,99132964803347141.43454987264M,145457975512824613862.91019662M,13359867918853.890141872984326M,62381044528805.81369106792717M,1238673422807.7695430862375426M,5296507095937199467852201999M,4381147189738410239608.444951M,30948502985.2801038564854274M,79042252465747.591086515816209M,34385478636825.399807971492095M,912739107953623107051129344M,2624588931782773705365521408M,4477039.4796831250777090M,2315104640518333633921430020M,669848836195964729944900608M,63110650150575751345.6289659M,295292267922731688.26250559499M,152518187501913094459274M,14351663679412186048811199231M,328817216070395212643630.50499M,152518207.814385447929193M,151301422707757447512067M,500737078173731741666038118.4M,715583536030728757830274510.5M,616656115291558034943060.745M,78635802993104659532365891859M,681250966726839455558841371.5M,58937492853557663564075M,226743265217640259298467.0214M,667345997380140338147649612M,344538545927877186491647488M,385284658718.3916026898743554M,681117314409.2496943643363842M,30948503593507542648110483.03M,309485051204133.9147100291608M,272395874030210823984695219.65M,3871572057713344.0952978439M,123794026950.9978386909036290M,34280014390064466007025991.74M,6409672642550334.65978946590M,5024802150136481719845891M,78732706212717450773496800774M,6238104452880581394876596749M,12405996798787139886944160256M,37343718946913354100873625.75M,46906891620977832213.58952463M,63588579600.8122000260270594M,30948503641341201874158131.2M,4662831608620530968879239.439M,5986709495752052965996757377M,15486339750283465.052410219537M,38704867770944729195225229M,3213770403926741549059M,4690660828047493804497271554M,3094850401360030279811533312M,166954236743323100257321064.1M,185691013559962243807.0259289M,1455066453700105672911061488.5M,27262505312269456754560.271362M,38069107473997696047256176658M,309485037779862310485.8324992M,2186994031352599998185341297M,12386734266193646972.109394993M,2187338948568405256890744847M,2417853947660535233322.033M,309485600193724391264814355M,5268590071816239174999541011M,79227275872231.010745125573126M,5608707547220.540240006547719M,26422733312042766152094867554M,328066199668191481334679502.03M,2300254324902454386504489.6351M,2213609288845146849.29M,270082468487549831492726M,10831975388278670522148979456M,108319753806405655644969.37086M,1462800241733828189465703.028M,46484730.4749394457336834M,4323935.2289071764341253M,1844.6768263821130242M,221360928897399521296M,6189700212279572063007.53920M,1416709.9453006982152451M,9444732966838802055680M,866642557903.0441155014689029M,33856213290627721972744198M,33858592920614282796007434M,309613930483974585.2391069696M,3096139339571506180400457216M,7258590882760590397341804M,12095899138854660635099278M,649923244958512706617141273.6M,10016005577714503936M,1955359375417134874625M,166831763111322434327150609M,10522490337600676229864757504M,14545795462972354298227200768M,67699845984832292151886131M,76162326636566320634691670M,26615994186624651388702949.376M,928790317484322250526032000M,3004975436021.4204666687277827M,16199605982837690516432486.5M,7118155225891.4212453971657986M,336653080444895560193M,67884018472812026003590M,649919465105.3302767720891906M,32497564693275576976034251008M,143870362894139549359472660M,16683692819994507628825806.0M,3249661550215206943122796953.6M,5261991332860744521811608576M,20554893424357237490057400M,33853427897293311457755183M,625160522786256814828.18044417M,16402823593384535248122988800M,41949949152761213286095276.6M,2901436728354830180843.5230M,14507109907.525503782225920M,30021240728396457480615363328M,735026972112673341331210351M,7.2058143860851970M,0.0001099511654921M,43.2345564227591175M,0.0000000000032521M,15536455536781719166051774547M,15305521689371591295261100373M,33555405042094224696764.727350M,236615744102517571890753.96462M,3417791231959756713044747.2485M,2197391004391351416039928126.0M,34471860556696016372280.357989M,3014609147488733311879088651.4M,32636683050807535691377.241196M,3138902425327433.0201366021733M,36033797012290588622999.606016M,31393958646929414350.956422509M,31877435045391372499925.685760M,238308248813370150495632.99700M,2954179018716104713243023.2417M,31401164849771418776.985163635M,3138250722303143515057.4376192M,3108200883850968044410878.7039M,31877444452085251248748.843635M,227317769264938764571873.36052M,33248375664036572515143271278M,35737448117928965795306825063M,36018005976129777794955.437428M,372216190972847415751008.13412M,2954179018716357268552446.0899M,2149396642074499.7676941864041M,3631184093451640370505.6616812M,344935398481088307661701121.10M,3573744811829206862699.5216498M,13949592868872923303211.3509M,32636683050820492327910.603091M,3135886705569596.3390893829733M,34758375975916272106124.965490M,360337970089776380210769.02258M,24449860958270076218830.581097M,360227546118623716475983230.50M,35403819548368522658012.353536M,35730281481034.925732311428931M,3262695003460493530283.2484162M,2796904850183967592.5682340197M,2239355088578978931311M,657693572954888706541551.616M,2485589358601651564022203665M,24856885446525996397.44647176M,2809572086557250208622384134M,9381548079828204178762634.24M,941890273008115562905670150M,309485010109575445933.721373M,632362783074504156658139143M,2809576809500475443036291074M,18666194105906749511828766.74M,941791140203760325822513411M,5274553386442845113699926.048M,248560347035973980981402112.2M,4643494108602338394103682310M,156798256310197678035593088.8M,2475970098762911677134406402M,24892540245193504353315.06464M,2489216078990590698011037973M,2484418246308007929480.480774M,248438046794502125128679962.4M,526272358278297695957543219.7M,496146476798386515368699699.7M,2176038118.9M
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  END ENCODED ASSEMBLY  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        }) {
            //Get the bits of the decimal
            var bits = decimal.GetBits(dec);

            //Skip forward if the highest scalar bit is set
            dynamic idx = bits[3] >> 16; //16 for skip tokens, <16 otherwise
            if(idx == 16) asmBufOff += (byte) bits[0];
            else {
                //Accumulate two 4 bit scales, then add to the buffer
                //Note that for even parity tokens, the byte we write here is immediately overwritten again 
                scaleAccum <<= 4;
                TinyBot_asmBuf[asmBufOff++] = scaleAccum |= idx;
                asmBufOff -= scaleParity ^= 1;
            }

            //Add the 88/96 bits of the integer number to the buffer
            idx >>= 4; //1 for skip tokens, 0 otherwise
            while(idx < 12) TinyBot_asmBuf[asmBufOff++] = (byte) (bits[idx / 4] >> idx++ * 8);
        }

        //Load the tiny bot from the assembly
        //We can't just load it and be done with it, because the byte[] overload doesn't add the assembly to the regular load path
        //As such load it whenever any assembly fails to load >:)
        System.ResolveEventHandler asmResolveCB = (_, _) => CurrentDomain.Load(TinyBot_asmBuf); //We can't use a dynamic variable for the callback because we need it to be a delegate type
        CurrentDomain.AssemblyResolve += asmResolveCB;
        TinyBot_asmBuf = CurrentDomain.CreateInstanceAndUnwrap(ToString(), "e");
        CurrentDomain.AssemblyResolve -= asmResolveCB;
    }

    public Move Think(Board board, Timer timer) => TinyBot_asmBuf.Think(board, timer);
}