using ChessChallenge.API;
using static System.AppDomain;

class MyBot : IChessBot {
    //TinyBot_asmBuf either holds the TinyBot IChessBot instance, or the assembly buffer during decoding
    dynamic TinyBot_asmBuf = new byte[6656];
    int asmBufOff, scaleParity;
    byte scaleAccum;

    public MyBot() {
        //Decode the assembly
        //The assembly is encoded in a semi-RLE-like format
        //There are two types of tokens:
        // - scaling factors 0-15: regular tokens
        //   - the decimal integer number encodes 12 bytes, which are copied to the assembly buffer
        //   - the decimal scaling factor encodes an additional 4 bits - two regular tokens are paired up, and their scaling factors are combined to form an extra byte
        // - scaling factor 16: skip tokens (can skip up to 255 bytes forward to efficiently encode a stretch of zero bytes)
        //   - the lowest byte of the decimal integer number contains the amount of bytes to skip forward by
        //   - the remaining 11 integer number bytes are copied to the assembly buffer
        //   - skip tokens are invisible to the scalar accumulator; they don't contribute their scale value, nor do they affect parity
        // - the sign bit is unused as a minus sign would require an extra token
        foreach(decimal dec in new[] {
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BEGIN ENCODED ASSEMBLY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            73786.976307732568653M,19807040628566.084401472995583M,31105283551.3167525259001891M,954912897280M,111971750039363155788000M,7737125245.5336267181203469M,73786978493861462528M,3143207130.9980358542361604M,41277563240262130762296328704M,7555786.3725983042899970M,1152921504606846992M,0.0000309237645936M,2866476455.1146806894145028M,9444732992127569494528M,0.0000412316868620M,2395184316.1405009736779929M,1099512014336M,944473.2966838802055477M,113640539676789186605613060M,1136405397032481866098.93458M,253782147137085114486609914.88M,19188552296141429730353110528M,128148110699625849560957030M,67701450782042557441.900638M,294014159497557021822487301.12M,28782648991943840730045240576M,124520835189950760495743046M,1051783725586247621517.64045M,210454198520417610646.23298048M,31877461311153407149993917952M,119685463949226554786644067M,107597865954980.428919799919M,464234456726761390344870574.08M,55088624547603614351900051968M,304651944502443839004344500M,27322107222350963871.7636785M,2537821471370871705715087.8464M,25378214713708511448660991488M,99133651225423872846331998M,337294546512565667927425118M,21678542986558909054515404.81M,73968371851815038432705592833M,333669687502439385779208476M,311908819832376628912521.552M,287834187549025.03676482481409M,30330905196791160740551661569M,39169674335220953191297871.0M,423129515647471950801207.559M,89767559134934287804300935.69M,8667252011756163248938895617M,36631142251080480030870768.4M,3179541130211177276786610.14M,451861856695127222499557378.57M,47661976029749627819107885569M,35784676504672353002697549.4M,43521844180785433371063118.5M,70873578424881718928485748481M,3715251012410718361038662144M,30707158547106395425898524.8M,331251798944670299058.733378M,2971193989865023815.5103477761M,27236059818782448609237475329M,46060588402173198717793103.2M,4666509189459230106822249.30M,8976788968041207229749235201M,15785530022130072971064212481M,35059555287566686808375333.9M,36268471883555937475.6905335M,3744912181654487316.1211065857M,32497286099377874136629064449M,50170991529207758909564547.8M,4497260681602269582219021.30M,10214903736976105.217208707841M,12071804350955098680770795521M,36389336795570193283357123.1M,367519850265514650902.790483M,39305937429944701842414968065M,34973142563738307639365412097M,41104010987033624220080565.2M,43159168279547318235267101.0M,93071235768096041391579392.1M,75207143048498302853440466434M,61172445230367390424288504.8M,62139650450226.3042778202573M,46425117412749357.855369459457M,63446844897585559411227753729M,57666693169704552323796223.5M,533145436160089080337007092M,1240187923201686407324222.210M,76754563375166462444546680322M,62260539342951540726045127.0M,621397113245099147739857380M,66851189450713612175836053762M,311935954271494870524888833M,6504114804923361682321577.01M,615352889972862374453772795M,7830233788061797.5107165492994M,930915419872112254042382337M,6407400739354191477214417.89M,633486094743.180717501383184M,73971181718023047.465924691969M,74899589524615324024501931011M,1178719571621624972854166.435M,12524639912843590987.95950975M,4488023775153134172.1955992323M,47046495870499824781794475523M,1138826993363855145452766.211M,1143662991790781847294772220M,76756834868969609194341.903620M,78304274086905236872050752259M,1206525658690638217675539.402M,121982386114948.3964593210283M,696389582610439735989231.94371M,53855151920334643421304324611M,1188393523826691457426719.752M,11424548591817.25530859439161M,623541343897905022.361638659M,8979603556976454402593509636M,123916606551738580476880.5830M,1310493352968694.673176396734M,58188234846717201694958300.419M,72729038696330.450939479585027M,79212445980539.376163421028298M,79195521554016127393670365208M,6592037320046557929242.4664320M,2785341477208215113928019711M,79202775035155282981448515567M,7919189518238537168284300084.3M,73966690673133803243269255424M,7736941074826033283437953023M,12088649460347069796188114M,27804943361.028676979654605M,7149116477046405132057995.4943M,76442816312744.119754815447551M,79208820125426.180245037776906M,265971981366940988266250.39M,5570730175919551.994663004672M,5570692399149377276237310976M,14506574886552648754331644M,79206402163096.072000351174591M,61904557512850445248233036.7M,54159437532815.796341280080896M,79130237807305.553902853619618M,7913023780730555390.2853619618M,15467544538986014403680862.71M,9593057757305.756713765261311M,79002092002411.783115513921420M,79034732317040557664692.535207M,6034875049338952.0714403375871M,52302414136155.269586355179263M,79115730734357.192554235690901M,79162878490846973488.957095838M,526120124830604877781993.84319M,49517171829940.278706072165887M,79107268511876.277691467694023M,7911573086348721593.5934758834M,649914506563593453.66761449471M,61277554981215.929485009851903M,79084298626153.442538940137368M,7913023780730555393.2919832480M,504456740824926884533475530.23M,50445674082492.688453347553023M,78905373749442.403338377363286M,789222998730599138.21440966368M,671570429088274.01906326284030M,47349893657977.852389102645246M,788425104553442.41004912967408M,7877722838728315.6556587138843M,7458369144642509.6641333587710M,77060223214452.840944623314686M,788630597408722.67942068551326M,78879985347986011340.342951562M,49516307618499034662.815332862M,48587748695242.946788099807230M,788497638995856.86337803189974M,7880986903393812.4852508032766M,779885176807182996957.46555134M,77988886028114.260273624170494M,788920749566747.98941438607035M,7894285017314507329037428290.9M,646811533844427589286.67706623M,60348339632949.753911252547326M,787832726105700.30226227003161M,7881833134866064.1533499145964M,742747211745504.38240040435198M,64680733092816.811187909864958M,788860287042581.80497549819552M,78867896200472863143601.372801M,349704129825879.52766969110526M,46421353623827.403625067371006M,787651382989911.26613362998995M,78743377541995335.668872642251M,6870398155166417.6872386628862M,60966705189610.448298528638718M,788739403499488.34720181714545M,788739402577213068526.62247055M,3744622694990143959207397.3758M,44564514402342.145590608975102M,787881081847086.13586714689253M,787482136695534.11501996179160M,69632422415830237405937.308414M,69632469638198.016215500104190M,788908658832767.28157319200415M,78588631384595.558627978509827M,1544955216487676357157712381M,1235474927735.785162312382718M,785559901292067.61507953180147M,78599511514063.253521481924099M,7736888179003548.8640704850173M,1235479649237.602192320233469M,786055573790914.90850526854630M,78609183234208627491600203310M,173287521093655433.61251770110M,14852843697892.920088432869118M,786611669706760.57637929680376M,78707106262510885239619714566M,61680241696540460318289.0238M,2783140817821.411214710677758M,786176464897145.29235226394180M,7862127299046996006696864927.1M,170192765488168056510.34278398M,5877787855861.324894806346238M,786974348928390.12091454291457M,7799020539301359387793778.2268M,191829562167019018605808770.52M,21349417399807.022530521977852M,78059112449195967.238208355351M,780675737862244.40924536044542M,5256924128779784809147546.363M,70248450346461.711866219221756M,779212961047656132.70528162857M,7800954763427807826487404.0399M,15159849426254982964385157116M,33110102778934.758836769915388M,78040978654135749.515260263449M,78050649820880771444308048897M,34000471253362481670733337.56M,78604734507234.095528775797244M,780325175384363982.42933636167M,77987787928745010835178.912878M,386808046257714555122.44385788M,36204995383418.531539958103804M,78103842889006881.967847701512M,7814736486414257744960139.9832M,464236487113046863155667200.0M,78918606671395.719772997947904M,1209165619.124890382893052M,108800187841.34149195497455M,75823969075566.746144371377407M,72419487574675.316418411497983M,79174969685961.944131968237584M,967173859465128425376970.6M,959390780258424589504845.6704M,11450822582942040559162746368M,32641070916852834844671997M,544011638337.97543532691435M,5880281300529007189.674697215M,72729199258448.176678537530880M,79219700328670.436902188941356M,14506980716048329183133723M,52611790570026258383.96472320M,4642360149340413529117686784M,65282400084182047645237301M,7919914855285588494918615041.1M,3094850121278983631.88212224M,99059570553914366041155209.09M,123794026965.3789889409122563M,120892585733230.2630289408M,5818638108483760921776384M,9598871007848253033340282884M,11806636783125015830284M,179905653161387891946311.1711M,123794010385.1799282669061122M,16495004197212411070998M,301309910614981216986.9062M,2953526668055829651238669619.2M,12495907851707.833050489971216M,15551768266828195.829756461061M,201810986457894.915413766M,5261245203856355033000325147M,400850636698950077964.83M,2936911105316773582373913092M,3204957367697681588058063872M,30948503035744.2710185508896M,3094850235627282521.873453054M,374046370955486530310465204.3M,5312807836776588.842765M,12385530430670093358332846208M,1568156438434414445099089.920M,44549175412532219806508M,249304115833762314.0873940742M,15550559286077639953644341280M,272625053642181910499.98731527M,25687255815175019506227151891M,7480579069060564245311003M,25713876054514973037689832312M,380691212833321567457105695.95M,37769260457153197050756595721M,6722099793737808053031422.67M,58716274617025783015958M,7922815838262713654.6931409418M,235293751916375981772661990.40M,78918677506750629297042489344M,3097040944273340531305286026.6M,23529715978373.764171423509055M,31154494188927695252042547.52M,618970610663883698939691008M,62453108394694417652687948.80M,9265297063971351.21698461471M,78613311800656213464513117718M,28059596806981963535195827.42M,38069097931421238947290153773M,42824279897502936.549747326976M,884209370406191096091539M,6822060486231768940704432161M,26048805267568222926389251091M,68280949343892412955036240.59M,5321894853115663385285820926M,55916977803458405.23274093182M,5986647882400738517662567976M,59872998837918626.32275643409M,528309731556277860240261556.4M,155081810090717450694579840.45M,4679160637082315170384236176.7M,3219981970840266952580793114.8M,404392333775200476022394395.5M,970084743220096805077997006.0M,5085969812586781990179789592M,13016584620041331337503508992M,30948503035744.2710185508896M,3094850235627282521.873453054M,2610174774802258260519485964M,648196930272629972303743488M,67341890519536575931482303.5M,23529523190157739137682.120746M,590755.013689169936416M,9910792758670.174401401675626M,9336624190966507819245764607M,124157659712850539767510.4003M,18569101171559742281818501.17M,635886535612636216506.909227M,95185919996363942400256M,2315889106094069.6737485585M,90464278874435828451840M,598670964332600557.7148007720M,3094850414690405960947863.828M,387048677709447291952252.77M,822725223405245836559104M,5928600867332874079396395778M,309485049359.3750648359291394M,166954236743323100257321064.1M,185691011715287836436.0707673M,1455066453700105672911061488.5M,27262505312269456754560.271362M,38069107473997696047239399442M,309485045158559939969.6531456M,2186994031354007373068894577M,12386734266193646972.109394993M,2187338948568405256890744851M,2417853947660535233322.033M,309485600193724391264814355M,5268590071816239174999541011M,79227275872231.010758010475014M,5608707547220.540240006547719M,26422733312042766152094867554M,328066199668191481334679502.03M,264487874766956312753212.7M,68069974634.61571592192M,1818129542650472010222081M,14878250836832549949407625985M,31215267464765886879473336.34M,243675955190691.69018474274M,90463265299589528488448M,464957755087523068.5328572785M,6806257434128533130006571008M,38962510487120245290336256.0M,36519231159783409237979300.096M,412113141613082.6286M,39037423641354445815676928003M,36000767265131505581111298560M,5789621307998680688519538M,1815809784177322098972M,4323935.2289071764341252M,1844.6768263821130242M,221360928897399521296M,618970021227957206300.753920M,1416709.9454106493780227M,9444732966838802055680M,866642557903.0441155014689029M,33856213290627721972744198M,330044809984769898062086154M,3096139315216039389742.355968M,3096625738419325357550209024M,12094294187677754906968554M,72585908827605903.97341995M,64992324558542.57594238508032M,10016005577714503936M,1955359375417134874625M,166831763111322434327150613M,15474250494742198428972883200M,19497555620113892990009742080M,87042659098666427666661683M,95505139750400456149467222M,26616069744488377303294803.968M,928865875348048165117886592M,3004975436021.4204666687281923M,58753794833272637466089881.7M,11427884097.40558594M,265171947159321.313280M,23422937827117428400227840M,2361183248.6436606432023299M,773713469033.8691832889774851M,146286425196941858077409353M,163213176007973684874248212M,8666307534640203.681815969792M,7737937495955405911344896768M,20552181752978698539761973M,2055546531536324677533.7240M,581832385301594318.67365903872M,73348079568187907567773604353M,319156932942829276531589274M,2115623320922.30774041411808M,294011892704000895.41264281856M,14507109907543095968270336M,333668525349117887178342403M,4835703442840581711.003761M,4722402516064794574850M,0.0001099511654923M,43.2345564227591175M,0.0000000000032521M,15536455536781719166051774547M,15305521689371591295261100373M,33555405042094224696764.727350M,236615744102517571890753.96462M,3417791231959756713044747.2485M,2197391004391351416039928126.0M,34471860556696016372280.357989M,3014609147488733311879088651.4M,32636683050807535691377.241196M,3138902425327433.0201366021733M,36033797012290588622999.606016M,31393958646929414350.956422509M,31877435045391372499925.685760M,238308248813370150495632.99700M,2954179018716104713243023.2417M,31401164849771418776.985163635M,3138250722303143515057.4376192M,3108200883850968044410878.7039M,31877444452085251248748.843635M,227317769264938764571873.36052M,33248375664036572515143271278M,35737448117928965795306825063M,36018005976129777794955.437428M,372216190972847415751008.13412M,2954179018716357268552446.0899M,2149396642074499.7676941864041M,3631184093451640370505.6616812M,344935398481088307661701121.10M,3573744811829206862699.5216498M,13949592868872923303211.3509M,32636683050820492327910.603091M,3135886705569596.3390893829733M,34758375975916272106124.965490M,360337970089776380210769.02258M,24449860958270076218830.581097M,360227546118623716475983230.50M,35403819548368522658012.353536M,35730281481034.925732311428931M,3262695003460493530283.2484162M,2796904850183967592.5682340197M,2239355088578978931311M,4045108626135363753535930.368M,9907180444033892736290856969M,3410460312876073506475870465M,936941435705262662304727552M,2475880115464823827799.214109M,3734400246328721158724719622M,18605985596257848942051348.54M,1237940043898200014469663517M,619837550021.0011179053416707M,21761042728380674.30231244802M,2486770446336356289146390804M,24855657817177277335.01599750M,1567981825232202866888803083M,6518532780930999561677.242912M,528667049929516533415523560.1M,93087347161722675647250867.3M,4846200703914117385879584M,495312030994777665554750132.0M,5262459405807032458363273235M,15679818252322083989905.09853M,1864201596268837388696420872M,21724636233485845796.34759688M,85002242M
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  END ENCODED ASSEMBLY  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        }) {
            //Get the bits of the decimal
            var bits = decimal.GetBits(dec);

            //Skip forward if the highest scalar bit is set
            dynamic idx = bits[3] >> 16; //16 for skip tokens, <16 otherwise
            if(idx == 16) asmBufOff += (byte) bits[0];
            else {
                //Accumulate two 4 bit scales, then add to the buffer
                //Note that for even parity tokens, the byte we write here is immediately overwritten again 
                scaleAccum <<= 4;
                TinyBot_asmBuf[asmBufOff++] = scaleAccum |= idx;
                asmBufOff -= scaleParity ^= 1;
            }

            //Add the 88/96 bits of the integer number to the buffer
            idx >>= 4; //1 for skip tokens, 0 otherwise
            while(idx < 12) TinyBot_asmBuf[asmBufOff++] = (byte) (bits[idx / 4] >> idx++ * 8);
        }

        //Load the tiny bot from the assembly
        //We can't just load it and be done with it, because the byte[] overload doesn't add the assembly to the regular load path
        //As such load it whenever any assembly fails to load >:)
        System.ResolveEventHandler asmResolveCB = (_, _) => CurrentDomain.Load(TinyBot_asmBuf); //We can't use a dynamic variable for the callback because we need it to be a delegate type
        CurrentDomain.AssemblyResolve += asmResolveCB;
        TinyBot_asmBuf = CurrentDomain.CreateInstanceAndUnwrap(ToString(), "e");
        CurrentDomain.AssemblyResolve -= asmResolveCB;
    }

    public Move Think(Board board, Timer timer) => TinyBot_asmBuf.Think(board, timer);
}