using ChessChallenge.API;
using static System.AppDomain;

class MyBot : IChessBot {
    //TinyBot_asmBuf either holds the TinyBot IChessBot instance, or the assembly buffer during decoding
    dynamic TinyBot_asmBuf = new byte[8704];
    int asmBufOff, scaleParity;
    byte scaleAccum;

    public MyBot() {
        //Decode the assembly
        //The assembly is encoded in a semi-RLE-like format
        //There are two types of tokens:
        // - scaling factors 0-15: regular tokens
        //   - the decimal integer number encodes 12 bytes, which are copied to the assembly buffer
        //   - the decimal scaling factor encodes an additional 4 bits - two regular tokens are paired up, and their scaling factors are combined to form an extra byte
        // - scaling factor 16: skip tokens (can skip up to 255 bytes forward to efficiently encode a stretch of zero bytes)
        //   - the lowest byte of the decimal integer number contains the amount of bytes to skip forward by
        //   - the remaining 11 integer number bytes are copied to the assembly buffer
        //   - skip tokens are invisible to the scalar accumulator; they don't contribute their scale value, nor do they affect parity
        // - the sign bit is unused as a minus sign would require an extra token
        foreach(decimal dec in new[] {
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> BEGIN ENCODED ASSEMBLY <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
            73786.976307732568653M,19807040628566.084401472995583M,31105283551.3167525259001891M,973988945920M,145803078670546473451744M,7737125245.5336267181203469M,73786978493861462528M,4110347786.6897391940011012M,41277563240262130762296328704M,7555786.3725983042899970M,1152921504606846992M,0.0000309237645936M,3732558468.0729736216063492M,9444733000923662516736M,0.0000412316868620M,3067649303.3011384521083033M,1099512119296M,944473.2966838802055477M,113640539676789186605613060M,1136405397032481866098.93458M,253782147137085114486609914.88M,19188552296141429730353110528M,128148110699625849560957030M,67701450782042557441.900638M,294014159497557021822487301.12M,28782648991943840730045240576M,124520835189950760495743046M,1051783725586247621517.64045M,210454198520417610646.23298048M,31877461311153407149993917952M,119685463949226554786644067M,107597865954980.428919799919M,464234456726761390344870574.08M,55088624547603614351900051968M,304651944502443839004344500M,27322107222350963871.7636785M,2537821471370871705715087.8464M,25378214713708511448660991488M,99133651225423872846331998M,337294546512565667927425118M,21678542986558909054515404.81M,73968371851815038432705592833M,333669687502439385779208476M,311908819832376628912521.552M,287834187549025.03676482481409M,30330905196791160740551661569M,39169674335220953191297871.0M,423129515647471950801207.559M,89767559134934287804300935.69M,8667252011756163248938895617M,36631142251080480030870768.4M,3179541130211177276786610.14M,451861856695127222499557378.57M,47661976029749627819107885569M,35784676504672353002697549.4M,43521844180785433371063118.5M,70873578424881718928485748481M,3715251012410718361038662144M,30707158547106395425898524.8M,331251798944670299058.733378M,2971193989865023815.5103477761M,27236059818782448609237475329M,46060588402173198717793103.2M,4666509189459230106822249.30M,8976788968041207229749235201M,15785530022130072971064212481M,35059555287566686808375333.9M,36268471883555937475.6905335M,3744912181654487316.1211065857M,32497286099377874136629064449M,50170991529207758909564547.8M,4497260681602269582219021.30M,10214903736976105.217208707841M,12071804350955098680770795521M,36389336795570193283357123.1M,367519850265514650902.790483M,39305937429944701842414968065M,34973142563738307639365412097M,41104010987033624220080565.2M,43159168279547318235267101.0M,93071235768096041391579392.1M,75207143048498302853440466434M,61172445230367390424288504.8M,62139650450226.3042778202573M,46425117412749357.855369459457M,63446844897585559411227753729M,57666693169704552323796223.5M,533145436160089080337007092M,1240187923201686407324222.210M,76754563375166462444546680322M,62260539342951540726045127.0M,621397113245099147739857380M,66851189450713612175836053762M,311935954271494870524888833M,6504114804923361682321577.01M,615352889972862374453772795M,7830233788061797.5107165492994M,930915419872112254042382337M,6407400739354191477214417.89M,633486094743.180717501383184M,73971181718023047.465924691969M,74899589524615324024501931011M,1178719571621624972854166.435M,12524639912843590987.95950975M,4488023775153134172.1955992323M,47046495870499824781794475523M,1138826993363855145452766.211M,1143662991790781847294772220M,76756834868969609194341.903620M,78304274086905236872050752259M,1206525658690638217675539.402M,121982386114948.3964593210283M,696389582610439735989231.94371M,53855151920334643421304324611M,1188393523826691457426719.752M,11424548591817.25530859439161M,623541343897905022.361638659M,8979603556976454402593509636M,123916606551738580476880.5830M,1310493352968694.673176396734M,58188234846717201694958300.419M,72729038696330.450939479585027M,79212445980539.376163421028298M,79195521554016127393670365208M,6592037320046557929242.4664320M,2785341477208215113928019711M,79202775035155282981448515567M,7919189518238537168284300084.3M,73966690673133803243269255424M,7736941074826033283437953023M,12088649460347069796188114M,27804943361.028676979654605M,7149116477046405132057995.4943M,76442816312744.119754815447551M,79208820125426.180245037776906M,265971981366940988266250.39M,5570730175919551.994663004672M,5570692399149377276237310976M,14506574886552648754331644M,79206402163096.072000351174591M,61904557512850445248233036.7M,54159437532815.796341280080896M,79130237807305.553902853619618M,7913023780730555390.2853619618M,15467544538986014403680862.71M,9593057757305.756713765261311M,79002092002411.783115513921420M,79034732317040557664692.535207M,6034875049338952.0714403375871M,52302414136155.269586355179263M,79115730734357.192554235690901M,79162878490846973488.957095838M,526120124830604877781993.84319M,49517171829940.278706072165887M,79107268511876.277691467694023M,7911573086348721593.5934758834M,649914506563593453.66761449471M,61277554981215.929485009851903M,79084298626153.442538940137368M,7913023780730555393.2919832480M,504456740824926884533475530.23M,50445674082492.688453347553023M,78905373749442.403338377363286M,789222998730599138.21440966368M,671570429088274.01906326284030M,47349893657977.852389102645246M,788425104553442.41004912967408M,7877722838728315.6556587138843M,7458369144642509.6641333587710M,77060223214452.840944623314686M,788630597408722.67942068551326M,78879985347986011340.342951562M,49516307618499034662.815332862M,48587748695242.946788099807230M,788497638995856.86337803189974M,7880986903393812.4852508032766M,779885176807182996957.46555134M,77988886028114.260273624170494M,788920749566747.98941438607035M,7894285017314507329037428290.9M,646811533844427589286.67706623M,60348339632949.753911252547326M,787832726105700.30226227003161M,7881833134866064.1533499145964M,742747211745504.38240040435198M,64680733092816.811187909864958M,788860287042581.80497549819552M,78867896200472863143601.372801M,349704129825879.52766969110526M,46421353623827.403625067371006M,787651382989911.26613362998995M,78743377541995335.668872642251M,6870398155166417.6872386628862M,60966705189610.448298528638718M,788739403499488.34720181714545M,788739402577213068526.62247055M,3744622694990143959207397.3758M,44564514402342.145590608975102M,787881081847086.13586714689253M,787482136695534.11501996179160M,69632422415830237405937.308414M,69632469638198.016215500104190M,788908658832767.28157319200415M,78588631384595.558627978509827M,1544955216487676357157712381M,1235474927735.785162312382718M,785559901292067.61507953180147M,78599511514063.253521481924099M,7736888179003548.8640704850173M,1235479649237.602192320233469M,786055573790914.90850526854630M,78609183234208627491600203310M,173287521093655433.61251770110M,14852843697892.920088432869118M,786611669706760.57637929680376M,78707106262510885239619714566M,61680241696540460318289.0238M,2783140817821.411214710677758M,786176464897145.29235226394180M,7862127299046996006696864927.1M,170192765488168056510.34278398M,5877787855861.324894806346238M,786974348928390.12091454291457M,7799020539301359387793778.2268M,191829562167019018605808770.52M,21349417399807.022530521977852M,78059112449195967.238208355351M,780675737862244.40924536044542M,5256924128779784809147546.363M,70248450346461.711866219221756M,779212961047656132.70528162857M,7800954763427807826487404.0399M,15159849426254982964385157116M,33110102778934.758836769915388M,78040978654135749.515260263449M,78050649820880771444308048897M,34000471253362481670733337.56M,78604734507234.095528775797244M,780325175384363982.42933636167M,77987787928745010835178.912878M,386808046257714555122.44385788M,36204995383418.531539958103804M,78103842889006881.967847701512M,7814736486414257744960139.9832M,464236487113046863155667200.0M,78918606671395.719772997947904M,1209165619.124890382893052M,108800187841.34149195497455M,75823969075566.746144371377407M,72419487574675.316418411497983M,79174969685961.944131968237584M,967173859465128425376970.6M,959390780258424589504845.6704M,11450822582942040559162746368M,32641070916852834844671997M,544011638337.97543532691435M,5880281300529007189.674697215M,72729199258448.176678537530880M,79219700328670.436902188941356M,14506980716048329183133723M,52611790570026258383.96472320M,4642360149340413529117686784M,65282400084182047645237301M,7919914855285588494918615041.1M,6327975545817870.27436032M,1145215428975350.4161313325312M,1813573196863952235003908M,39626170515504870401008141312M,30948501618583547581680844.80M,39626170515411636079672283173M,39055760794746205638293192.704M,34055440338843600949111422979M,78918678095317240.574914855550M,1208909681073185877.880575M,218010924579800053.4212862047M,154889041056894334.43837034527M,618970077793174.230092742698M,3038207.5719820796629250M,34357671794202960887445335050M,991079275867045587620.7902720M,309485223078714282627563519M,387157205771334.40952978439M,999543308285.6123975607189250M,3872371933.6104979196805890M,24178539473428457455618.56M,77891854621918.53503062216974M,6166561152915580349426675.43M,3614782294903610.24484476684M,322783525172399646937073042.14M,681964263459253968.2355019809M,26048795822835257178508888595M,68256770827494490872007911.63M,5321894816222175237782831614M,4972727723809099288.452006526M,5986647882399331142779013416M,5987299846898374484.856539665M,528067946392354933546313754.6M,15508171564194664142058146349M,4679160633392910060646970615.1M,3219740181986995212003941556.2M,342494387337634888345039950.7M,970084743205685286267055975.4M,3538544763480901071452461848M,3729616473761747818387409408M,4961630050822864617241379592M,30948503035744271018550889.6M,58789773364012390547161M,415760456472221054.7548488205M,93108557206.2449900666882562M,9911224467746160883962480426M,123794030640.3466534328139523M,13328499607856644662247.816992M,945372467770622021611489539M,3094850396246474378139144721M,4690717496296961915351142673M,945370898063187437532809728M,369285441669192061406848.0M,465441162918520864647.417640M,309485037780.3108017015488770M,71181696511009685084654190.25M,55941157611843393578.34674193M,154863397502834650567.05188369M,12585106676874311.84702509833M,30948504385431561783428377.62M,35089180276317.53953281M,1742737699636300737479442M,34360169999104187005736981249M,272625116333276744732555346.12M,494927604566002.53104130M,1516842562958535762805.3524740M,26785263127121124.405806865M,109352300573184892930560M,731963700403401.2981886486M,14907363803515245112409985064M,456007814056412214283080843.47M,15788760098844612795503.13489M,2785981836833466736.2107659537M,651983647171353816496941403.5M,537007258246417346.2704540466M,71242801548208732858703.94644M,195096448779609543129.36981779M,4642304368908390022493765428M,4952972459233391116288.0M,7561849928337155539280855556M,34357690682917208153583979008M,7834443634814160981721112M,35325671119765901940228M,40048037602635563931140M,6932464221843709394631545.0391M,309636420613668058106502398M,34379437512827980668686070528M,681359606952929270800003892.5M,19342815491717077862973.957M,5275780610998308838439257105M,687214121416492222897609.02669M,99132964803347141.43572427776M,145457975512824613862.91019662M,13359867918853.890141872984326M,50001644135952.01094207668493M,1238673422807.7695430862375426M,5296507095937199467852201999M,4381147189738410239608.444951M,30948502985.2801038564854274M,79042252465747.591086515816209M,45526939654476.608935607468287M,1266954373100709455240169984M,3553043961246808911539864576M,5893749.4245440303858690M,3243559669982368865865576964M,669848836195964729944900608M,63110650150575751345.6290427M,295292267922731688.26250559501M,152518187501913094459274M,14351663679412186048811199231M,328817216070395212641952.78339M,152518204.999635680822633M,151375210809952192561155M,438840076209462729639068825.6M,71485817316026235084163026.09M,37658133375251572.13774480407M,68100822404035382346970757.19M,448149755129344.5176784786947M,4566157878708.7345948440265730M,1241576467856337355523491667M,47246841.54424950663172M,38761162834685281720663776M,1267014703453328395855462.4M,6407779080643634740583475.20M,12379402326164946103.33564942M,42960539817902.044816567442543M,78918677506770.235510709554943M,6251806011772678372122320746M,328066199668191481334679507.15M,1527246854925795203121437347.1M,1255285734460235428324.841733M,1331754179192407619038.0855058M,123988234863458996.85880795926M,1580194985288048522780108.3919M,349838953691002.79632485289470M,49723119339767200828820029.45M,183231877824821797.33323791M,309485037563.800248327932416M,399441984705846.28747373117965M,20741057868455511641292801M,78628615884507484928655764234M,4033633866233301494161998349M,18653631324755394711076874.38M,1330785544364.9700540468889090M,38709590134634841264279584M,8139051353082185318403M,1742737699636300771033618M,34362587850743416264086524673M,72402709401272995506752.06164M,12391576278618585519.372985603M,841534696468511265549975552.4M,2757199664314901954218472346.5M,3126523954717304016537485415.8M,25911773691563331691414.025M,1260952445773656370690722304M,9394171738711.09780378489349M,1337592150311095937085758M,78626330147055446496725437950M,13310264235773047135669323789M,500011733850830222285466651.8M,200561832336.1428857311922690M,559197772827.8098592090686466M,2785855318023385119739570462.7M,2785855318023385119739572021.1M,590085700733788008920616897.9M,2785855318023385119.7395748914M,13822440482347269819798033M,3734381639124500027762479882M,4046279440617052480127110952M,6191212677430571473913795.79M,13768650.1440727732529922M,142408867923598625610762M,1145215428975414184.7992672123M,373442888202307682526246279.4M,1394020397999348231725103155.9M,2492796001224930258633891847M,9737489739333465645522216M,44372460506809038932025548328M,3908393481230432453.2699136M,9904804965221675959018586624M,27262519528655193168981000448M,19509644877960953213458908.947M,29838735735506991846.531268606M,78918677506750630358220.237317M,7895739153865655009.2602171487M,12592345367333376482335129.59M,34.7892494355M,38686835154896530478276288514M,9128334412513061577.687040M,4836293719509963512807680M,9905957055390592179185387405M,123794028810.0533963034788099M,38686835154896531577720807426M,380666759843041.84757212938240M,1237941004036162318569884876.9M,3094850525370870390319.611904M,309485069139156705370775049.6M,8058699515940.277689685795344M,137686498341204338368610M,1274092629565974834.0160684121M,44770399304828599040770M,7629573406390116889.6090M,23882792877174874289457410826M,494928179112582.74355223M,2418442452120144389566212M,3094850636051334832577708331M,309485065449807890629.2134428M,12379401772762483.14597081119M,458122628237646911040514.01735M,1046299326796.41592629866M,137334445344935340260612500.58M,303490203534340958.54091832062M,2982915863916739206025373567.8M,29818202564467.864045387185679M,67357481844651140187.3710954M,278584865878826567.81165395974M,76295733782426192184337M,2481124790663890947.8301993523M,86824533671581307803.2647185M,99121954859795270.45982453770M,1237940531799654897504852428.8M,933290734666385.7861398495232M,231510263602.2997345013271042M,123794019572.3087764666254338M,204262091720685333550084.63881M,14507109835375554391523.914M,6914111193.2812756862137858M,1083197539879.9079251686458115M,108319753933227021176217.27358M,1852074355649738783721091.700M,46484730.4749394457363458M,971464590.6954305348305413M,1844.6768263821130242M,258254417044818624532M,309485012271303266031.108096M,944473.2970137336939779M,14167099451907470524672M,1269021238808.9179752248639749M,49574702362579760449716230M,49577395587215978071261194M,309664459899016162.8717178624M,3096644644386445874776128512M,7260564688035652023615615M,12098352598037710512914604M,897513142533166169872514969.6M,75204885748168098646480485378M,33850107523610991166881833M,44473046345449852M,526124517481716151065824486.4M,741411537828126518150656M,51983810257784308390363161M,67699845903767460204511.251M,928761983285759284273479.681M,1417019.7925152616891651M,14172359652973754723072M,55362750219265704012M,5536387611917254.6633M,3117805332463438089042.24768M,632797108704596681818368M,587537948332729741915258885M,13927381890.60079976M,432922026079734.988800M,28825325083528001337460224M,649919465105.3308259455763203M,125737139680454892473876545M,142664204086135972331257876M,5261892159057326.896171865600M,32496610780722335284059083008M,20554635239464456085307994M,20554875015049335682957.598M,35590908369335461.261495808256M,32496058271914561644974358785M,761625646049409920036765900M,367513762827.584981081063651M,42401363626964988474.880428288M,11452673754782910010682775808M,3748555488377176858715752.9M,396531026143553647665872913M,2785709866902086751.480768768M,49828635529044219849533868032M,3626778323535020298797520M,116063888540892288281.149571M,297105798323157.00194540823296M,4722402516064794574850M,0.0001099511655691M,43.2345564227596039M,43.2345564227605001M,1578488776112.0664865875337225M,25687255815171642022715130159M,35399087847894394272897.458544M,60689279440553590.492393331M,15305521689371591295261100.373M,31389061792901532506424.623872M,23661574410251757189075.396462M,202500331083858574637140.79079M,21973910043913514160399.281260M,301547016579700654802579.82580M,3138403068305592457609.6642162M,122589947978996689085345.139M,3107954387164836525201099.7074M,338565175029376031303.56166241M,360228490581134548112594.25326M,31378148549813.760147640574275M,36653787307943033045452.355924M,313825072226019119897282.74768M,24892308753842985933562.994548M,36340769793613134325.331878757M,3012204649346309503969.2985445M,313825072227393081135189456.39M,122642024219494358333.349748M,12265602392185798532.0547429M,360228490581159945154642.16909M,36653787600785.109960262906697M,31877435155349301599101.321317M,341780112320444343374544.48500M,125040764597547544677.086052M,3567902964113572871124.9654885M,34170780967078441367474.761289M,359889634960528904.54538667520M,356790297322922499274944.30053M,360277434758625527976085054.45M,35378549610838589582563.241833M,34784892340634.913597249843053M,33551683654811894583307.233652M,34780098201213649.971484914537M,13352235429103639111063.2819M,33861199968392857982732365.167M,3075891686555915950779.0099045M,3630426160989122521449735.4351M,31398766697213619029480.203629M,3386837409091702.9705344700974M,3137816768153728868373.7868656M,34166002601256495114063531.264M,3139376089811177487926.9218675M,326366830508075511146218425.29M,30425038231860059220258.350445M,14071388520258738.9248430949M,3449113226028011717008355.7972M,20565582060244067214477391.215M,3137939938087552482020.2189935M,202392052195971840275.18191872M,3046414850228040897667.9072370M,313987666972136256346367230.49M,8751179541575970413M,9913229647924490767620440.064M,2485575687908099641332535554M,24784491751367429441.74770184M,3428542106784568283682112785M,24178891868718830735856.64M,2483143209439985007424045824M,2179830312293495837804794.374M,2470167121384781861945856M,6299449290548013696489226.24M,9910811796355662023221051904M,9907199185924463137965737.985M,15185369205411700731239662080M,18666194474841631459807723.56M,327623658683072953076748565M,6250949515298072342.47827467M,9381267876623278299131494.43M,2475969826092770176109446912M,866679923620776669355508250.2M,64993268998015676351.25112848M,9909588868883055688709913874M,528667059217686309824922035.3M,5270940499034967252694794553M,24843946534920462848865.75112M,3640474180760046268992846.5M,24844182648206.17130443145984M,248438046794502125128679962.4M,1122979222093752204602114150.9M,650531013813536351879607603.9M,217609040131211090134466591.3M,12476445958686363938456227.86M,9709333642013610047309825M
//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  END ENCODED ASSEMBLY  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
        }) {
            //Get the bits of the decimal
            var bits = decimal.GetBits(dec);

            //Skip forward if the highest scalar bit is set
            dynamic idx = bits[3] >> 16; //16 for skip tokens, <16 otherwise
            if(idx == 16) asmBufOff += (byte) bits[0];
            else {
                //Accumulate two 4 bit scales, then add to the buffer
                //Note that for even parity tokens, the byte we write here is immediately overwritten again 
                scaleAccum <<= 4;
                TinyBot_asmBuf[asmBufOff++] = scaleAccum |= idx;
                asmBufOff -= scaleParity ^= 1;
            }

            //Add the 88/96 bits of the integer number to the buffer
            idx >>= 4; //1 for skip tokens, 0 otherwise
            while(idx < 12) TinyBot_asmBuf[asmBufOff++] = (byte) (bits[idx / 4] >> idx++ * 8);
        }

        //Load the tiny bot from the assembly
        //We can't just load it and be done with it, because the byte[] overload doesn't add the assembly to the regular load path
        //As such load it whenever any assembly fails to load >:)
        System.ResolveEventHandler asmResolveCB = (_, _) => CurrentDomain.Load(TinyBot_asmBuf); //We can't use a dynamic variable for the callback because we need it to be a delegate type
        CurrentDomain.AssemblyResolve += asmResolveCB;
        TinyBot_asmBuf = CurrentDomain.CreateInstanceAndUnwrap(ToString(), "e");
        CurrentDomain.AssemblyResolve -= asmResolveCB;
    }

    public Move Think(Board board, Timer timer) => TinyBot_asmBuf.Think(board, timer);
}